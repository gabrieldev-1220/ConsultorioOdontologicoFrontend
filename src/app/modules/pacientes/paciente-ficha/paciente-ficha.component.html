<div class="ficha-container">
  <!-- TÍTULO: SOLO APELLIDO Y NOMBRE -->
  <div class="header-info">
    <h2>Ficha de {{ paciente?.apellido }}, {{ paciente?.nombre }}</h2>
  </div>

  <!-- PESTAÑAS -->
  <div class="tabs">
    <button [class.active]="selectedTab === 'contacto'" (click)="setTab('contacto')">Información</button>
    <button [class.active]="selectedTab === 'odontograma'" (click)="setTab('odontograma')">Odontograma</button>
    <button [class.active]="selectedTab === 'historia-clinica'" (click)="setTab('historia-clinica')">Historia Clínica</button>
    <button [class.active]="selectedTab === 'presupuesto'" (click)="setTab('presupuesto')">Presupuesto</button>
    <button [class.active]="selectedTab === 'prescripciones'" (click)="setTab('prescripciones')">Prescripciones / Recetas</button>
    <button [class.active]="selectedTab === 'facturacion'" (click)="setTab('facturacion')">Facturación</button>
  </div>

  <div class="tab-content" *ngIf="paciente">
    <!-- TAB: Información -->
    <div *ngIf="selectedTab === 'contacto'">
      <h3>Información del Paciente</h3>
      <p><strong>DNI:</strong> {{ paciente.dni }}</p>
      <p><strong>Teléfono:</strong> {{ paciente.telefono }}</p>
      <p><strong>Email:</strong> {{ paciente.email }}</p>
      <p><strong>Dirección:</strong> {{ paciente.direccion }}</p>
      <p><strong>Fecha de Nacimiento:</strong> {{ paciente.fechaNacimiento | date:'dd/MM/yyyy' }}</p>
      <p><strong>Activo:</strong> {{ paciente.activo ? 'Sí' : 'No' }}</p>
    </div>

    <!-- TAB: Historia Clínica -->
    <div *ngIf="selectedTab === 'historia-clinica'">
      <div class="historial-header">
        <h3>Historia Clínica</h3>
        <button class="btn-historial-odontogramas" (click)="mostrarHistorialOdontogramas = true">
          Historial Odontogramas
        </button>
      </div>
      <app-historial-clinico [pacienteId]="pacienteId"></app-historial-clinico>

      <!-- MODAL HISTORIAL ODONTOGRAMAS -->
      <div class="modal-backdrop" *ngIf="mostrarHistorialOdontogramas" (click)="mostrarHistorialOdontogramas = false">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3>Historial de Odontogramas</h3>
            <button class="btn-cerrar" (click)="mostrarHistorialOdontogramas = false">×</button>
          </div>
          <div class="modal-body">
            <div class="odontograma-item" *ngFor="let o of odontogramasHistorial" (click)="seleccionarOdontograma(o)">
              <div class="fecha">{{ o.fecha | date:'dd/MM/yyyy' }}</div>
              <div class="odontologo">Dr. {{ o.odontologo }}</div>
              <div class="procedimientos">{{ o.procedimientos.join(', ') }}</div>
            </div>
            <p class="empty" *ngIf="odontogramasHistorial.length === 0">No hay odontogramas registrados.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: Odontograma -->
    <div *ngIf="selectedTab === 'odontograma'">
      <h3>Odontograma</h3>
      <app-odontogram [pacienteId]="pacienteId"></app-odontogram>
    </div>

    <!-- TAB: Presupuesto -->
    <div *ngIf="selectedTab === 'presupuesto'">
      <h3>Presupuesto</h3>
      <app-presupuesto [pacienteId]="pacienteId"></app-presupuesto>
    </div>

    <!-- TAB: Prescripciones -->
    <div *ngIf="selectedTab === 'prescripciones'">
      <h3>Prescripciones / Recetas</h3>
      <app-prescripciones [pacienteId]="pacienteId"></app-prescripciones>
    </div>

    <!-- TAB: Facturación -->
    <div *ngIf="selectedTab === 'facturacion'">
      <h3>Facturación</h3>
      <app-facturacion [pacienteId]="pacienteId"></app-facturacion>
    </div>
  </div>
</div>